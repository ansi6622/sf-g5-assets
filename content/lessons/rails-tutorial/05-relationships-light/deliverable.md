---
title: Rails - Rails Relationships (Light)
blooms: application
---

# Goal: Rails Relationships (Light)

## Objectives:

* Double down on scaffolds
* Introduce database relationships

-----------

## Projects are fine, but I want my projects to have to-do tasks:
### That is a Relationship!

Remember how easy the scaffolding was? Let's try it again. This time, all together.

```bash
  rails generate scaffold tasks name:string project_id:integer
```

This time our migration, has two columns. The name is a string, just like with
the project. But now we have a project_id column that we can use to build an
association with the projects.

Let's run the migration: `rake db:migrate`

## Building those associations
#### (Clams shells down!)

Open your project model. It is located at 'app/models/project.rb'. Add this line
in the middle of the class:

```ruby
  has_many :tasks
```

What we are saying is that the project has many task data models, which it can
figure out from the project_id column on the task.

Let's add an association back on the task model, located at 'app/models/task.rb'.
In the middle of the class write this code:

```ruby
  belongs_to :project
```

#### Let's go look at the tasks we just scaffolded

Run your server. Go to the path '/tasks'.

It's all working, but our form is a little funky. We have to know the database id
for the projects record and select it as a number. That's not a great interface.

#### Fixing the Form

Let's go to the task form generated by the scaffold: 'app/views/tasks/_form.html.erb'.
It has a section for the project id that we are going to make more user friendly.

Find the second div with the class 'field'. It has our project information.
There is a funny looking tag in there that runs some special Rails code. We are
looking for the code related to the number_field. Let's change it to show all the
names of the projects in a drop down.

```erb
  <%= f.collection_select :project_id,
        Project.all, :id, :name, include_blank: "Select a Project" %>
```

Check out how the form looks in our CRUD Scaffold. It changed, and is much easier to use.

#### Fixing the Index

When we go back to the list of task. Each task still has a number for the project id next
to it. It's hard to understand as a user.

In the index view for tasks, 'app/views/tasks/index.html.erb', we see that a tag that lists
the `task.project_id`. Let's change it to the name:

```erb
  <%= task.project.name %>
```

#### Oh, no explosions!

What happens if the task has no project! It is hard to do that with the form in its current
state. But the data may already be in that state before we created this drop down. It was pretty
hard to use.

We can solve this by creating a method on the model. Let's go into the task model and add more code:

```ruby
  def project_name
    if project
      project.name
    else
      "-- none --"
    end
  end
```

Now we have to change the view to use this new method:

```erb
  <%= task.project_name %>
```

#### Other views

We don't want that project id showing up in other places either. So in the 'app/views/tasks/show.html.erb'
we will want to change `@task.project_id` to `@task.project_name`.

## Now let's do it together
